[general]
output = "icarus_disappearance"
primfn = "default_primary_classification"
pidfn = "default_pid"
fsthresh = [
    "@photon_threshold",
    "@electron_threshold",
    "@muon_threshold",
    "@pion_threshold",
    "@proton_threshold",
]

[parameters]
photon_threshold = 25.0
electron_threshold = 25.0
muon_threshold = 143.425
pion_threshold = 25.0
proton_threshold = 50.0
flash_low_t = -0.5
flash_high_t = 1.6
bnb_fom2_cut = 0.98

[[category]] # 0 : Contained, fiducial, single muon, single proton
cuts = [
    { name = "neutrino"        },
    { name = "fiducial_cut"    },
    { name = "containment_cut" },
    { name = "no_photons",       parameters = [ "@photon_threshold"   ] },
    { name = "no_electrons",     parameters = [ "@electron_threshold" ] },
    { name = "no_charged_pions", parameters = [ "@pion_threshold"     ] },
    { name = "single_muon",      parameters = [ "@muon_threshold"     ] },
    { name = "single_proton",    parameters = [ "@proton_threshold"   ] },
]

[[category]] # 1 : Single muon, single proton
cuts = [
    { name = "neutrino" },
    { name = "no_photons",       parameters = [ "@photon_threshold"   ] },
    { name = "no_electrons",     parameters = [ "@electron_threshold" ] },
    { name = "no_charged_pions", parameters = [ "@pion_threshold"     ] },
    { name = "single_muon",      parameters = [ "@muon_threshold"     ] },
    { name = "single_proton",    parameters = [ "@proton_threshold"   ] },
]

[[category]] # 2 : Contained, fiducial, single muon, multiple protons
cuts = [
    { name = "neutrino"        },
    { name = "fiducial_cut"    },
    { name = "containment_cut" },
    { name = "no_photons",       parameters = [ "@photon_threshold"   ] },
    { name = "no_electrons",     parameters = [ "@electron_threshold" ] },
    { name = "no_charged_pions", parameters = [ "@pion_threshold"     ] },
    { name = "single_muon",      parameters = [ "@muon_threshold"     ] },
    { name = "!no_protons",      parameters = [ "@proton_threshold"   ] },
]

[[category]] # 3 : Single muon, multiple protons
cuts = [
    { name = "neutrino" },
    { name = "no_photons",       parameters = [ "@photon_threshold"   ] },
    { name = "no_electrons",     parameters = [ "@electron_threshold" ] },
    { name = "no_charged_pions", parameters = [ "@pion_threshold"     ] },
    { name = "single_muon",      parameters = [ "@muon_threshold"     ] },
    { name = "!no_protons",      parameters = [ "@proton_threshold"   ] },
]

[[category]] # 4 : Contained, fiducial, single muon
cuts = [
    { name = "neutrino"        },
    { name = "fiducial_cut"    },
    { name = "containment_cut" },
    { name = "single_muon", parameters = [ "@muon_threshold" ] },
]

[[category]] # 5 : Single muon
cuts = [
    { name = "neutrino" },
    { name = "single_muon", parameters = [ "@muon_threshold" ] },
]

[[category]] # 6 : Neutrino, charged current
cuts = [
    { name = "neutrino" },
    { name = "iscc"     },
]

[[category]] # 7 : Neutrino, neutral current
cuts = [
    { name = "neutrino" },
    { name = "!iscc"    },
]

[[category]] # 8 : Cosmic
cuts = [
    { name = "!neutrino" },
]

[[sample]]
name = "nominal"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/nominal/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "cvext"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/cvext/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var00"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var00/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var01"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var01/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var02"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var02/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var03m"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var03m/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var03p"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var03p/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var04"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var04/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var05"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var05/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var06"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var06/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var07"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var07/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var09m"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var09m/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var09p"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var09p/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var10m"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var10m/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var10p"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var10p/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var11"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var11/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var12m"
path = "/pnfs/icarus/scratch/users/mueller/production/simulation/var12m/flat/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var12p"
path = "/pnfs/icarus/scratch/users/mueller/production/simulation/var12p/flat/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var13m"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var13m/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "var13p"
path = "/pnfs/icarus/persistent/users/mueller/production/simulation/var13p/input*.flat.root"
ismc = true
disable = false

[[sample]]
name = "offbeam"
path = "/pnfs/icarus/persistent/users/mueller/production/data/offbeam/input*.flat.root"
ismc = false
disable = false

[[sample]]
name = "onbeam"
path = "/pnfs/icarus/persistent/users/mueller/production/data/onbeam/input*.flat.root"
ismc = false
disable = false

[[tree]]
name = "selected"
sim_only = false
add_exposure = true
mode = "reco"
cut = [
    { name = "fiducial_cut",              type = "reco" },
    { name = "containment_cut",           type = "reco" },
    { name = "flash_cut",                 type = "reco",  parameters = [ "@flash_low_t", "@flash_high_t" ] },
    { name = "no_photons",                type = "reco",  parameters = [ "@photon_threshold"             ] },
    { name = "no_electrons",              type = "reco",  parameters = [ "@electron_threshold"           ] },
    { name = "no_charged_pions",          type = "reco",  parameters = [ "@pion_threshold"               ] },
    { name = "single_muon",               type = "reco",  parameters = [ "@muon_threshold"               ] }, 
    { name = "!no_protons",               type = "reco",  parameters = [ "@proton_threshold"             ] },    
    { name = "trigger_emulation_cut",     type = "event", decrements_exposure = false },
    { name = "data_quality_cut",          type = "event", decrements_exposure = true },
    { name = "beam_quality_cut",          type = "spill", decrements_exposure = false }, # Should decrement exposure, but CAF files are bugged
    { name = "bnb_fom2_cut",              type = "event", decrements_exposure = false, parameters = [ "@bnb_fom2_cut" ]}, # Should decrement exposure, but CAF files are bugged
]
branch = [
    # Interaction-level truth/reco branches
    { name = "neutrino_id",             type = "true"    },
    { name = "baseline",                type = "mctruth" },
    { name = "cc",                      type = "mctruth" },
    { name = "pdg",                     type = "mctruth" },
    { name = "interaction_type",        type = "mctruth" },
    { name = "category",                type = "true"    },
    { name = "neutrino_energy",         type = "mctruth" },
    { name = "visible_energy",          type = "both"    },
    { name = "visible_energy_calosub",  type = "both"    },
    { name = "leading_muon_vertex_gap", type = "both"    },
    { name = "photon_multiplicity",     type = "both", parameters = [ "@photon_threshold"   ]},
    { name = "electron_multiplicity",   type = "both", parameters = [ "@electron_threshold" ]},
    { name = "muon_multiplicity",       type = "both", parameters = [ "@muon_threshold"     ]},
    { name = "pion_multiplicity",       type = "both", parameters = [ "@pion_threshold"     ]},
    { name = "proton_multiplicity",     type = "both", parameters = [ "@proton_threshold"   ]},

    # Kinematic imbalance & angles
    { name = "opening_angle", type = "both" },
    { name = "dpT",           type = "both" },
    { name = "dpT_lp",        type = "both" },
    { name = "dphiT",         type = "both" },
    { name = "dalphaT",       type = "both" },
    { name = "dpL",           type = "both" },
    { name = "dpL_lp",        type = "both" },
    { name = "pn",            type = "both" },
    { name = "pn_lp",         type = "both" },

    # Vertex & flash
    { name = "vertex_x",         type = "both" },
    { name = "vertex_y",         type = "both" },
    { name = "vertex_z",         type = "both" },
    { name = "flash_time",       type = "reco" },
    { name = "flash_total_pe",   type = "reco" },
    { name = "flash_hypothesis", type = "reco" },
    { name = "containment",      type = "reco" },
    { name = "fiducial",         type = "reco" },

    # Leading MUON interaction-level
    { name = "end_x",             type = "both_particle", selector = "leading_muon"   },
    { name = "end_y",             type = "both_particle", selector = "leading_muon"   },
    { name = "end_z",             type = "both_particle", selector = "leading_muon"   },
    { name = "ke",                type = "both_particle", selector = "leading_muon"   },
    { name = "length",            type = "both_particle", selector = "leading_muon"   },
    { name = "dpT",               type = "both_particle", selector = "leading_muon"   },
    { name = "polar_angle",       type = "both_particle", selector = "leading_muon"   },
    { name = "azimuthal_angle",   type = "both_particle", selector = "leading_muon"   },
    { name = "primary_softmax",   type = "reco_particle", selector = "leading_muon"   },
    { name = "secondary_softmax", type = "reco_particle", selector = "leading_muon"   },
    { name = "muon_softmax",      type = "reco_particle", selector = "leading_muon"   },
    { name = "pion_softmax",      type = "reco_particle", selector = "leading_muon"   },
    { name = "proton_softmax",    type = "reco_particle", selector = "leading_muon"   },
    { name = "mip_softmax",       type = "reco_particle", selector = "leading_muon"   },
    { name = "hadron_softmax",    type = "reco_particle", selector = "leading_muon"   },

    # Leading PROTON interaction-level
    { name = "end_x",             type = "both_particle", selector = "leading_proton" },
    { name = "end_y",             type = "both_particle", selector = "leading_proton" },
    { name = "end_z",             type = "both_particle", selector = "leading_proton" },
    { name = "ke",                type = "both_particle", selector = "leading_proton" },
    { name = "length",            type = "both_particle", selector = "leading_proton" },
    { name = "dpT",               type = "both_particle", selector = "leading_proton" },
    { name = "polar_angle",       type = "both_particle", selector = "leading_proton" },
    { name = "azimuthal_angle",   type = "both_particle", selector = "leading_proton" },
    { name = "primary_softmax",   type = "reco_particle", selector = "leading_proton" },
    { name = "secondary_softmax", type = "reco_particle", selector = "leading_proton" },
    { name = "muon_softmax",      type = "reco_particle", selector = "leading_proton" },
    { name = "pion_softmax",      type = "reco_particle", selector = "leading_proton" },
    { name = "proton_softmax",    type = "reco_particle", selector = "leading_proton" },
    { name = "mip_softmax",       type = "reco_particle", selector = "leading_proton" },
    { name = "hadron_softmax",    type = "reco_particle", selector = "leading_proton" }
]

[[tree]]
name = "signal"
sim_only = true
add_exposure = true
mode = "true"
cut = [
    { name = "neutrino",              type = "true" },
    { name = "fiducial_cut",          type = "true" },
    { name = "containment_cut",       type = "true" },
    { name = "no_photons",            type = "true",  parameters = [ "@photon_threshold"   ] },
    { name = "no_electrons",          type = "true",  parameters = [ "@electron_threshold" ] },
    { name = "no_charged_pions",      type = "true",  parameters = [ "@pion_threshold"     ] },
    { name = "single_muon",           type = "true",  parameters = [ "@muon_threshold"     ] },
    { name = "!no_protons",           type = "true",  parameters = [ "@proton_threshold"   ] },
    { name = "trigger_emulation_cut", type = "event", decrements_exposure = false },
]
branch = [
    # Interaction-level truth branches
    { name = "neutrino_id",            type = "true"    },
    { name = "containment_cut",        type = "both"    },
    { name = "fiducial_cut",           type = "both"    },
    { name = "baseline",               type = "mctruth" },
    { name = "cc",                     type = "mctruth" },
    { name = "pdg",                    type = "mctruth" },
    { name = "interaction_mode",       type = "mctruth" },
    { name = "interaction_type",       type = "mctruth" },
    { name = "category",               type = "true"    },
    { name = "neutrino_energy",        type = "mctruth" },
    { name = "visible_energy",         type = "both"    },
    { name = "visible_energy_calosub", type = "true"    },
    { name = "leading_muon_vertex_gap", type = "both"   },

    # Interaction-level selection variables
    { name = "photon_multiplicity",   type = "reco", parameters = [ "@photon_threshold"   ]},
    { name = "electron_multiplicity", type = "reco", parameters = [ "@electron_threshold" ]},
    { name = "muon_multiplicity",     type = "reco", parameters = [ "@muon_threshold"     ]},
    { name = "pion_multiplicity",     type = "reco", parameters = [ "@pion_threshold"     ]},
    { name = "proton_multiplicity",   type = "reco", parameters = [ "@proton_threshold"   ]},
    { name = "flash_time",            type = "reco" },

    # Kinematic imbalance & angles
    { name = "opening_angle", type = "both" },
    { name = "dpT",           type = "both" },
    { name = "dpT_lp",        type = "both" },
    { name = "dphiT",         type = "both" },
    { name = "dalphaT",       type = "both" },
    { name = "dpL",           type = "both" },
    { name = "dpL_lp",        type = "both" },
    { name = "pn",            type = "both" },
    { name = "pn_lp",         type = "both" },

    # True-vertex
    { name = "vertex_x", type = "true" },
    { name = "vertex_y", type = "true" },
    { name = "vertex_z", type = "true" },

    # Leading MUON particle-level
    { name = "end_x",             type = "both_particle", selector = "leading_muon" },
    { name = "end_y",             type = "both_particle", selector = "leading_muon" },
    { name = "end_z",             type = "both_particle", selector = "leading_muon" },
    { name = "ke",                type = "both_particle", selector = "leading_muon" },
    { name = "length",            type = "both_particle", selector = "leading_muon" },
    { name = "dpT",               type = "both_particle", selector = "leading_muon" },
    { name = "polar_angle",       type = "both_particle", selector = "leading_muon" },
    { name = "azimuthal_angle",   type = "both_particle", selector = "leading_muon" },
    { name = "primary_softmax",   type = "reco_particle", selector = "leading_muon" },
    { name = "secondary_softmax", type = "reco_particle", selector = "leading_muon" },
    { name = "muon_softmax",      type = "reco_particle", selector = "leading_muon" },
    { name = "pion_softmax",      type = "reco_particle", selector = "leading_muon" },
    { name = "proton_softmax",    type = "reco_particle", selector = "leading_muon" },
    { name = "mip_softmax",       type = "reco_particle", selector = "leading_muon" },
    { name = "hadron_softmax",    type = "reco_particle", selector = "leading_muon" },

    # Leading PROTON particle-level
    { name = "end_x",             type = "both_particle", selector = "leading_proton" },
    { name = "end_y",             type = "both_particle", selector = "leading_proton" },
    { name = "end_z",             type = "both_particle", selector = "leading_proton" },
    { name = "ke",                type = "both_particle", selector = "leading_proton" },
    { name = "length",            type = "both_particle", selector = "leading_proton" },
    { name = "dpT",               type = "both_particle", selector = "leading_proton" },
    { name = "polar_angle",       type = "both_particle", selector = "leading_proton" },
    { name = "azimuthal_angle",   type = "both_particle", selector = "leading_proton" },
    { name = "primary_softmax",   type = "reco_particle", selector = "leading_proton" },
    { name = "secondary_softmax", type = "reco_particle", selector = "leading_proton" },
    { name = "muon_softmax",      type = "reco_particle", selector = "leading_proton" },
    { name = "pion_softmax",      type = "reco_particle", selector = "leading_proton" },
    { name = "proton_softmax",    type = "reco_particle", selector = "leading_proton" },
    { name = "mip_softmax",       type = "reco_particle", selector = "leading_proton" },
    { name = "hadron_softmax",    type = "reco_particle", selector = "leading_proton" }
]